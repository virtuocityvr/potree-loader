{"version":3,"file":"potree-loader.es16.js","sources":["../src/point-cloud-octree-node.ts"],"sourcesContent":["import { Box3, BufferGeometry, EventDispatcher, Object3D, Points, Sphere } from 'three';\r\nimport { PointCloudOctreeGeometryNode } from './point-cloud-octree-geometry-node';\r\nimport { IPointCloudTreeNode } from './types';\r\n\r\nexport class PointCloudOctreeNode extends EventDispatcher implements IPointCloudTreeNode {\r\n  geometryNode: PointCloudOctreeGeometryNode;\r\n  sceneNode: Points;\r\n  pcIndex: number | undefined = undefined;\r\n  boundingBoxNode: Object3D | null = null;\r\n  readonly children: (IPointCloudTreeNode | null)[];\r\n  readonly loaded = true;\r\n  readonly isTreeNode: boolean = true;\r\n  readonly isGeometryNode: boolean = false;\r\n\r\n  constructor(geometryNode: PointCloudOctreeGeometryNode, sceneNode: Points) {\r\n    super();\r\n\r\n    this.geometryNode = geometryNode;\r\n    this.sceneNode = sceneNode;\r\n    this.children = geometryNode.children.slice();\r\n  }\r\n\r\n  dispose(): void {\r\n    this.geometryNode.dispose();\r\n  }\r\n\r\n  disposeSceneNode(): void {\r\n    const node = this.sceneNode;\r\n\r\n    if (node.geometry instanceof BufferGeometry) {\r\n      const attributes = node.geometry.attributes;\r\n\r\n      // tslint:disable-next-line:forin\r\n      for (const key in attributes) {\r\n        if (key === 'position') {\r\n          delete (attributes[key] as any).array;\r\n        }\r\n\r\n        delete attributes[key];\r\n      }\r\n\r\n      node.geometry.dispose();\r\n      node.geometry = undefined as any;\r\n    }\r\n  }\r\n\r\n  traverse(cb: (node: IPointCloudTreeNode) => void, includeSelf?: boolean): void {\r\n    this.geometryNode.traverse(cb, includeSelf);\r\n  }\r\n\r\n  get id() {\r\n    return this.geometryNode.id;\r\n  }\r\n\r\n  get name() {\r\n    return this.geometryNode.name;\r\n  }\r\n\r\n  get level(): number {\r\n    return this.geometryNode.level;\r\n  }\r\n\r\n  get isLeafNode(): boolean {\r\n    return this.geometryNode.isLeafNode;\r\n  }\r\n\r\n  get numPoints(): number {\r\n    return this.geometryNode.numPoints;\r\n  }\r\n\r\n  get index() {\r\n    return this.geometryNode.index;\r\n  }\r\n\r\n  get boundingSphere(): Sphere {\r\n    return this.geometryNode.boundingSphere;\r\n  }\r\n\r\n  get boundingBox(): Box3 {\r\n    return this.geometryNode.boundingBox;\r\n  }\r\n\r\n  get spacing() {\r\n    return this.geometryNode.spacing;\r\n  }\r\n}\r\n"],"names":["PointCloudOctreeNode","EventDispatcher","geometryNode","sceneNode","node","BufferGeometry","attributes","key","cb","includeSelf"],"mappings":";AAIO,MAAMA,UAA6BC,EAA+C;AAAA,EAUvF,YAAYC,GAA4CC,GAAmB;AACnE,aARsB,KAAA,UAAA,QACK,KAAA,kBAAA,MAEnC,KAAS,SAAS,IAClB,KAAS,aAAsB,IAC/B,KAAS,iBAA0B,IAKjC,KAAK,eAAeD,GACpB,KAAK,YAAYC,GACZ,KAAA,WAAWD,EAAa,SAAS,MAAM;AAAA,EAC9C;AAAA,EAEA,UAAgB;AACd,SAAK,aAAa;EACpB;AAAA,EAEA,mBAAyB;AACvB,UAAME,IAAO,KAAK;AAEd,QAAAA,EAAK,oBAAoBC,GAAgB;AACrC,YAAAC,IAAaF,EAAK,SAAS;AAGjC,iBAAWG,KAAOD;AAChB,QAAIC,MAAQ,cACF,OAAAD,EAAWC,CAAG,EAAU,OAGlC,OAAOD,EAAWC,CAAG;AAGvB,MAAAH,EAAK,SAAS,WACdA,EAAK,WAAW;AAAA;AAAA,EAEpB;AAAA,EAEA,SAASI,GAAyCC,GAA6B;AACxE,SAAA,aAAa,SAASD,GAAIC,CAAW;AAAA,EAC5C;AAAA,EAEA,IAAI,KAAK;AACP,WAAO,KAAK,aAAa;AAAA,EAC3B;AAAA,EAEA,IAAI,OAAO;AACT,WAAO,KAAK,aAAa;AAAA,EAC3B;AAAA,EAEA,IAAI,QAAgB;AAClB,WAAO,KAAK,aAAa;AAAA,EAC3B;AAAA,EAEA,IAAI,aAAsB;AACxB,WAAO,KAAK,aAAa;AAAA,EAC3B;AAAA,EAEA,IAAI,YAAoB;AACtB,WAAO,KAAK,aAAa;AAAA,EAC3B;AAAA,EAEA,IAAI,QAAQ;AACV,WAAO,KAAK,aAAa;AAAA,EAC3B;AAAA,EAEA,IAAI,iBAAyB;AAC3B,WAAO,KAAK,aAAa;AAAA,EAC3B;AAAA,EAEA,IAAI,cAAoB;AACtB,WAAO,KAAK,aAAa;AAAA,EAC3B;AAAA,EAEA,IAAI,UAAU;AACZ,WAAO,KAAK,aAAa;AAAA,EAC3B;AACF;"}