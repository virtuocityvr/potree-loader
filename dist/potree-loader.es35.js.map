{"version":3,"file":"potree-loader.es35.js","sources":["../src/loading2/OctreeGeometryNode.ts"],"sourcesContent":["import { IPointCloudTreeNode } from './../types';\r\n\r\n// import * as THREE from \"../../../../libs/three.js/build/three.module.js\";\r\nimport { Box3,Sphere } from \"three\";\r\nimport { OctreeGeometry } from './OctreeGeometry';\r\n\r\nexport class OctreeGeometryNode implements IPointCloudTreeNode{\r\n\r\n\tconstructor(public name:string, public octreeGeometry:OctreeGeometry, public boundingBox:Box3){\r\n\t\tthis.id = OctreeGeometryNode.IDCount++;\r\n\t\tthis.index = parseInt(name.charAt(name.length - 1));\r\n\t\tthis.boundingSphere = boundingBox.getBoundingSphere(new Sphere());\r\n\t\tthis.numPoints = 0;\r\n\t\tthis.oneTimeDisposeHandlers = [];\r\n\t}\r\n\r\n\tloaded: boolean = false;\r\n\tloading: boolean = false;\r\n\tparent: OctreeGeometryNode | null = null;\r\n\tgeometry: THREE.BufferGeometry | null = null;\r\n\tnodeType?: number;\r\n\tbyteOffset?: bigint ;\r\n\tbyteSize?: bigint;\r\n\thierarchyByteOffset?: bigint;\r\n\thierarchyByteSize?: bigint;\r\n\thasChildren: boolean = false;\r\n\tspacing!: number;\r\n\tdensity?: number;\r\n\tisLeafNode: boolean = true;\r\n\treadonly isTreeNode: boolean = false;\r\n  \treadonly isGeometryNode: boolean = true;\r\n\treadonly children: ReadonlyArray<OctreeGeometryNode | null> = [\r\n\t\tnull,\r\n\t\tnull,\r\n\t\tnull,\r\n\t\tnull,\r\n\t\tnull,\r\n\t\tnull,\r\n\t\tnull,\r\n\t\tnull,\r\n\t];\r\n\r\n\t// create static IDCount variable\r\n\tstatic IDCount = 0;\r\n\tid: number;\r\n\tindex: number;\r\n\tboundingSphere: Sphere;\r\n\tnumPoints: number;\r\n\tlevel!: number;\r\n\toneTimeDisposeHandlers: Function[];\r\n\r\n\t// isGeometryNode(){\r\n\t// \treturn true;\r\n\t// }\r\n\r\n\tgetLevel(){\r\n\t\treturn this.level;\r\n\t}\r\n\r\n\t// isTreeNode(){\r\n\t// \treturn false;\r\n\t// } // Converted to property\r\n\r\n\tisLoaded(){\r\n\t\treturn this.loaded;\r\n\t}\r\n\r\n\tgetBoundingSphere(){\r\n\t\treturn this.boundingSphere;\r\n\t}\r\n\r\n\t// getChildren(){\r\n\t// \tlet children = [];\r\n\r\n\t// \tfor (let i = 0; i < 8; i++) {\r\n\t// \t\tif (this.children[i]) {\r\n\t// \t\t\tchildren.push(this.children[i]);\r\n\t// \t\t}\r\n\t// \t}\r\n\r\n\t// \treturn children;\r\n\t// }\r\n\r\n\tgetBoundingBox(){\r\n\t\treturn this.boundingBox;\r\n\t}\r\n\r\n\tload(){\r\n\r\n\t\tif (this.octreeGeometry.numNodesLoading >= this.octreeGeometry.maxNumNodesLoading) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (this.octreeGeometry.loader) {\r\n\t\t\tthis.octreeGeometry.loader.load(this);\r\n\t\t}\r\n\t}\r\n\r\n\tgetNumPoints(){\r\n\t\treturn this.numPoints;\r\n\t}\r\n\r\n\tdispose(): void{\r\n\t\tif (this.geometry && this.parent != null) {\r\n\t\t\tthis.geometry.dispose();\r\n\t\t\tthis.geometry = null;\r\n\t\t\tthis.loaded = false;\r\n\r\n\t\t\t// this.dispatchEvent( { type: 'dispose' } );\r\n\t\t\tfor (let i = 0; i < this.oneTimeDisposeHandlers.length; i++) {\r\n\t\t\t\tlet handler = this.oneTimeDisposeHandlers[i];\r\n\t\t\t\thandler();\r\n\t\t\t}\r\n\t\t\tthis.oneTimeDisposeHandlers = [];\r\n\t\t}\r\n\t}\r\n\r\n\ttraverse(cb: (node: OctreeGeometryNode) => void, includeSelf = true): void {\r\n\t\tconst stack: OctreeGeometryNode[] = includeSelf ? [this] : [];\r\n\t\r\n\t\tlet current: OctreeGeometryNode | undefined;\r\n\t\r\n\t\twhile ((current = stack.pop()) !== undefined) {\r\n\t\t\tcb(current);\r\n\t\t\r\n\t\t\tfor (const child of current.children) {\r\n\t\t\t\t\tif (child !== null) {\r\n\t\t\t\t\tstack.push(child);\r\n\t\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\r\n\r\n};\r\n\r\nOctreeGeometryNode.IDCount = 0;"],"names":["_OctreeGeometryNode","name","octreeGeometry","boundingBox","Sphere","i","handler","cb","includeSelf","stack","current","child","OctreeGeometryNode"],"mappings":";AAMO,MAAMA,IAAN,MAAuD;AAAA,EAE7D,YAAmBC,GAAoBC,GAAsCC,GAAiB;AAA3E,SAAA,OAAAF,GAAoB,KAAA,iBAAAC,GAAsC,KAAA,cAAAC,GAQ3D,KAAA,SAAA,IACC,KAAA,UAAA,IACiB,KAAA,SAAA,MACI,KAAA,WAAA,MAMjB,KAAA,cAAA,IAGD,KAAA,aAAA,IACtB,KAAS,aAAsB,IAC7B,KAAS,iBAA0B,IACrC,KAAS,WAAqD;AAAA,MAC7D;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,IAAA,GA9BA,KAAK,KAAKH,EAAmB,WAC7B,KAAK,QAAQ,SAASC,EAAK,OAAOA,EAAK,SAAS,CAAC,CAAC,GAClD,KAAK,iBAAiBE,EAAY,kBAAkB,IAAIC,EAAQ,CAAA,GAChE,KAAK,YAAY,GACjB,KAAK,yBAAyB;EAC/B;AAAA;AAAA;AAAA;AAAA,EAyCA,WAAU;AACT,WAAO,KAAK;AAAA,EACb;AAAA;AAAA;AAAA;AAAA,EAMA,WAAU;AACT,WAAO,KAAK;AAAA,EACb;AAAA,EAEA,oBAAmB;AAClB,WAAO,KAAK;AAAA,EACb;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAcA,iBAAgB;AACf,WAAO,KAAK;AAAA,EACb;AAAA,EAEA,OAAM;AAEL,IAAI,KAAK,eAAe,mBAAmB,KAAK,eAAe,sBAI3D,KAAK,eAAe,UAClB,KAAA,eAAe,OAAO,KAAK,IAAI;AAAA,EAEtC;AAAA,EAEA,eAAc;AACb,WAAO,KAAK;AAAA,EACb;AAAA,EAEA,UAAe;AACd,QAAI,KAAK,YAAY,KAAK,UAAU,MAAM;AACzC,WAAK,SAAS,WACd,KAAK,WAAW,MAChB,KAAK,SAAS;AAGd,eAASC,IAAI,GAAGA,IAAI,KAAK,uBAAuB,QAAQA,KAAK;AACxD,YAAAC,IAAU,KAAK,uBAAuBD,CAAC;AACnC,QAAAC;;AAET,WAAK,yBAAyB;;EAEhC;AAAA,EAEA,SAASC,GAAwCC,IAAc,IAAY;AAC1E,UAAMC,IAA8BD,IAAc,CAAC,IAAI,IAAI,CAAA;AAEvD,QAAAE;AAEJ,YAAQA,IAAUD,EAAM,IAAI,OAAO,UAAW;AAC7C,MAAAF,EAAGG,CAAO;AAEC,iBAAAC,KAASD,EAAQ;AAC1B,QAAIC,MAAU,QACdF,EAAM,KAAKE,CAAK;AAAA;AAAA,EAIpB;AAID;AAjIO,IAAMC,IAANZ;AAAMY,EAqCL,UAAU;AA8FlBA,EAAmB,UAAU;"}